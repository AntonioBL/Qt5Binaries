#!/bin/bash

# Run this file inside an Ubuntu Bionic Docker image
# Run this file after Recipe1, loading the image generated by the previous job

#Set architecture: amd64, i386
ARCH=$1

set -e # Halt on error
set -x # Be verbose

cd qt5source
cd build

export NINJAJOBS=-j$(($(nproc))) 
make -j $(($(nproc)))
make install -j $(($(nproc)+1))

echo 'Compilation and installation completed'

# Allow non-root users to access the files
chmod -R a+rwx /qt5

tar -zcf qt5linux_${ARCH}.tar.gz /qt5 
mv qt5linux_${ARCH}.tar.gz /output

chmod -R a+rwx /output

echo 'Recipe2 completed'
